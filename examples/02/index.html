<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>[02] InfrontJS States - The Basics</title>
</head>
<body>

<div id="app"></div>
<script type="module">
  import * as IF from "./../../src/IF.js";

  window.onload = function()
  {
      window.po = new IF.PathObject( { a : 'hello', b : { c : 'World' } } );

    class HomeState extends IF.State
    {
      static ROUTE = [ '/', '/home' ];

      async enter()
      {
        const tmpl = await this.app.templateManager.load( "layout.html" );
        this.app.container.innerHTML = `
        <ul>
            <li><a href="${this.app.router.createUrl(AnotherState.ROUTE)}">Another State</a></li>
            <li><a href="${this.app.router.createUrl(ForbiddenState.ROUTE)}">Forbidden State</a></li>
            <li><a href="${this.app.router.createUrl('does-not-exists')}">404</a></li>
        </ul>
        <div id="test"></div>
        `;

        this.app.templateManager.render( document.getElementById( 'test' ), tmpl );
        this.app.templateManager.render( document.getElementById( 'test' ), tmpl );
          this.app.templateManager.render( document.getElementById( 'test' ), tmpl );
      }

    }

    class AnotherState extends IF.State
    {
      static ROUTE = '/another';

      enter()
      {
        this.app.container.innerHTML =  `
        <h1>Another State</h1>
        <a href="${this.app.router.createUrl(HomeState.ROUTE[ 1 ])}">Back Home</a>
        `;
      }
    }

    class ForbiddenState extends IF.State
    {
        static ROUTE = '/forbidden';

        canEnter()
        {
            alert( "Entering this state is forbidden." );
            return false;
        }

        getRedirectTo()
        {
            const app = IF.App.get();
            return app.router.createUrl( HomeState.ROUTE[ 0 ] );
        }
    }

    async function run()
    {
      const app = new IF.App( document.getElementById( 'app' ), { "router" : { "basePath" : "/infrontjs-infrontjs/examples/02/" } } );
      app.stateManager.add( HomeState );
      app.stateManager.add( AnotherState );
      app.stateManager.add( ForbiddenState );
      app.run();
    }

    run();
  };
</script>
</body>
</html>
